<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>The Spex specification language and verifier</title>
  <link rel="stylesheet" href="style.css?modified=2024-11-14">
  <link rel="shortcut icon" type="image/png" href="asset/spex.png">
  <script data-goatcounter="https://spex-lang.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
</head>
<body>
<header class=box>
  <nav id="navbar" class="menu">
    <a href="index.html"><img class="logo" src="asset/spex.png" alt="Spex glasses">Spex</a>
    <a href="tutorial.html">Tutorial</a>
    <a href="install.html">Install</a>
    <a href="community.html">Community</a>
  </nav>
  <div class="push">
    <a href="https://github.com/spex-lang/spex">Code</a>
  </div>
</header>
<noscript>
  <img src="https://spex-lang.goatcounter.com/count?t=The+Spex+specification+language+and+verifier"
       alt="goatcounter">
</noscript>
<main>
<h1 id="spex">Spex</h1>
<p>Spex is a specification language and verifier for HTTP API
servers.</p>
<p>Here's an example specification:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode spex"><code class="sourceCode spex"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">component</span> PetStore <span class="kw">where</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>addPet       <span class="ot">:</span> <span class="kw">POST</span> /pet Pet</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>getPet       <span class="ot">:</span> <span class="kw">GET</span> /pet/<span class="ot">{</span>petId <span class="ot">:</span> <span class="ot">@</span><span class="dt">Int</span><span class="ot">}</span> <span class="ot">-&gt;</span> Pet</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>getBadPet    <span class="ot">:</span> <span class="kw">GET</span> /pet/badJson/<span class="ot">{</span>petId <span class="ot">:</span> <span class="ot">@</span><span class="dt">Int</span><span class="ot">}</span> <span class="ot">-&gt;</span> Pet</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>neverReached <span class="ot">:</span> <span class="kw">GET</span> /noThere <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Pet =</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="ot">{</span> petId   <span class="ot">:</span> <span class="dt">Int</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  , petName <span class="ot">:</span> <span class="dt">String</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="ot">}</span></span></code></pre></div>
<p>The verifer takes a specification and an URL and checks if the server
behind the URL respects the specification. In particular the verifier
looks for:</p>
<ul>
<li>Non-2xx responses;</li>
<li>JSON response decode and type errors;</li>
<li>Unreachable endpoints.</li>
</ul>
<p>Here's an example run that uses the above specification:</p>
<pre><code>$ spex verify example/petstore-modal-faults.spex \
    --tests 2000 --host http://localhost --port 8080

i Verifying the deployment:    http://localhost:8080
  against the specification:   example/petstore-modal-faults.spex

i Checking the specification.

i Waiting for health check to pass...

✓ Health check passed!

i Starting to run tests...

✓ Done testing, here are the results: 

Test failure:

1. addPet : POST /pet {petId = -46, petName = qux}
2. addPet : POST /pet {petId = -46, petName = qux}
  ↳ 409 Conflict: Pet already exists
------------------------------------------------------------------------
Test failure (1 shrinks):

1. getBadPet : GET /pet/badJson/99 -&gt; Pet
decode failure: Error in $: endOfInput &quot;petId&quot;:99,&quot;petName&quot;:&quot;qux&quot;}
------------------------------------------------------------------------

Coverage:
  2xx:
    26% addPet (530 ops)
    8% getBadPet (156 ops)
    8% getPet (160 ops)
  404:
    15% getBadPet (308 ops)
    17% getPet (336 ops)
    25% neverReached (509 ops)
  409:
    0% addPet (1 ops)

Not covered (no non-404 responses):
  neverReached

Total operations (ops): 2000

Use --seed 3967796076964233976 to reproduce</code></pre>
<p>Note that the server running on <code>http://localhost:8080</code>
needs to be written in another language and be deployed, before the Spex
verifer is run.</p>
<p>For an introduction to how the above works in more detail, please see
the <a href="tutorial.html">tutorial</a>.</p>
</main>
</body>
</html>
